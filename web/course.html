<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Catalog | EduStream</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        tailwind.config = { 
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        emerald: {
                            50: '#ecfdf5',
                            100: '#d1fae5',
                            200: '#a7f3d0',
                            300: '#6ee7b7',
                            400: '#34d399',
                            500: '#10b981',
                            600: '#059669',
                            700: '#047857',
                            800: '#065f46',
                            900: '#064e3b',
                        }
                    }
                }
            }
        };
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
    <style>
        .course-card:hover .course-image { transform: scale(1.05); }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #10b981; border-radius: 10px; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 min-h-screen transition-colors duration-300">

    <header class="bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-8">
                <a href="dashboard.html" class="text-xl font-bold text-emerald-600 font-mono tracking-tighter">EduStream</a>
                <nav class="hidden md:flex gap-6 text-sm font-medium">
                    <a href="dashboard.html" class="text-slate-600 dark:text-slate-400 hover:text-emerald-600 transition">Dashboard</a>
                    <a href="course.html" class="text-emerald-600 font-bold">Courses</a>
                </nav>
            </div>
            
            <div class="flex items-center gap-4">
                <button id="theme-toggle" class="p-2 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300">
                    <svg id="sun-icon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 9h-1m15.364-6.364l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707-.707M12 8a4 4 0 100 8 4 4 0 000-8z"/></svg>
                    <svg id="moon-icon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg>
                </button>
                <div class="h-8 w-px bg-slate-200 dark:bg-slate-800"></div>
                <button id="logout-btn" class="text-sm font-semibold text-slate-600 dark:text-slate-400 hover:text-red-500 transition">Logout</button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8 md:py-12">
        <div class="flex flex-col md:flex-row md:items-end justify-between gap-6 mb-12">
            <div>
                <h1 class="text-3xl md:text-4xl font-black text-slate-900 dark:text-white mb-2 tracking-tight">Expand Your <span class="text-emerald-600">Knowledge.</span></h1>
                <p class="text-slate-500 dark:text-slate-400">Discover premium courses designed by industry experts.</p>
            </div>
            
            <div class="flex gap-2">
                <div class="relative group">
                    <input type="text" id="course-search" placeholder="Search courses..." class="pl-10 pr-4 py-3 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-2xl w-full md:w-64 focus:ring-2 focus:ring-emerald-500 outline-none transition-all">
                    <svg class="w-5 h-5 absolute left-3 top-3.5 text-slate-400 group-focus-within:text-emerald-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                </div>
            </div>
        </div>

        <div id="loading-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <div class="h-80 bg-slate-200 dark:bg-slate-900 rounded-3xl animate-pulse"></div>
            <div class="h-80 bg-slate-200 dark:bg-slate-900 rounded-3xl animate-pulse"></div>
            <div class="h-80 bg-slate-200 dark:bg-slate-900 rounded-3xl animate-pulse"></div>
            <div class="h-80 bg-slate-200 dark:bg-slate-900 rounded-3xl animate-pulse"></div>
        </div>

        <div id="course-grid" class="hidden grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Dynamic Content -->
        </div>

        <div id="empty-state" class="hidden text-center py-20">
            <div class="bg-slate-100 dark:bg-slate-900 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-10 h-10 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 9.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            </div>
            <p class="text-slate-500 dark:text-slate-400 font-medium">No courses found matching your criteria.</p>
        </div>
    </main>

    <script src="supabase.js"></script>
    <script>
       
        const supabaseClient = supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY);
        let allCourses = [];

        async function fetchCourses() {
            try {
                const { data, error } = await supabaseClient
                    .from('courses')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;
                allCourses = data;
                renderCourses(data);
            } catch (err) {
                console.error(err);
            }
        }

        function renderCourses(courses) {
            const grid = document.getElementById('course-grid');
            const loader = document.getElementById('loading-grid');
            const empty = document.getElementById('empty-state');
            
            loader.classList.add('hidden');
            
            if (courses.length === 0) {
                grid.classList.add('hidden');
                empty.classList.remove('hidden');
                return;
            }

            empty.classList.add('hidden');
            grid.classList.remove('hidden');
            
            grid.innerHTML = courses.map(course => {
                // Formatting currency to Sri Lankan Rupees (Rs.)
                const formattedPrice = course.price > 0 
                    ? `Rs. ${parseFloat(course.price).toLocaleString('en-LK')}` 
                    : 'Free';

                return `
                <div class="course-card group bg-white dark:bg-slate-900 rounded-3xl border border-slate-200 dark:border-slate-800 overflow-hidden shadow-sm hover:shadow-xl hover:shadow-emerald-600/5 transition-all duration-300">
                    <div class="relative h-48 overflow-hidden">
                        <img src="${course.thumbnail || 'https://images.unsplash.com/photo-1516321318423-f06f85e504b3?w=800'}" 
                             alt="${course.title}" 
                             class="course-image w-full h-full object-cover transition-transform duration-500">
                        <div class="absolute top-4 left-4">
                            <span class="px-3 py-1 bg-white/90 dark:bg-slate-900/90 backdrop-blur text-emerald-600 text-[10px] font-black uppercase tracking-wider rounded-lg shadow-sm border border-emerald-100 dark:border-emerald-900/30">
                                ${course.category || 'Course'}
                            </span>
                        </div>
                    </div>
                    <div class="p-6">
                        <h3 class="font-bold text-slate-900 dark:text-white mb-2 line-clamp-2 group-hover:text-emerald-600 transition-colors h-12">${course.title}</h3>
                        <div class="flex items-center justify-between mt-6">
                            <span class="text-lg font-black text-emerald-600">${formattedPrice}</span>
                            <button onclick="viewCourse('${course.id}')" class="p-2 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 rounded-xl hover:bg-emerald-600 hover:text-white transition-all">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7-7 7"/></svg>
                            </button>
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        function viewCourse(id) {
            window.location.href = `singlecourse.html?id=${id}`;
        }

        // Search logic
        document.getElementById('course-search').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            const filtered = allCourses.filter(c => 
                c.title.toLowerCase().includes(query) || 
                (c.category && c.category.toLowerCase().includes(query))
            );
            renderCourses(filtered);
        });

        // Theme toggle
        document.getElementById('theme-toggle').addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            updateThemeIcons();
        });

        function updateThemeIcons() {
            const isDark = document.documentElement.classList.contains('dark');
            document.getElementById('sun-icon').classList.toggle('hidden', !isDark);
            document.getElementById('moon-icon').classList.toggle('hidden', isDark);
        }

        document.getElementById('logout-btn').addEventListener('click', async () => {
            await supabaseClient.auth.signOut();
            window.location.href = 'login.html';
        });

        // Init
        updateThemeIcons();
        fetchCourses();
    </script>
</body>
</html>
